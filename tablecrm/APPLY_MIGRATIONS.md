# Инструкция по применению миграций Alembic на сервере backend

Данный документ описывает процесс применения миграций Alembic в рабочем окружении. Инструкция подходит для всех окружений, где backend запускается в Docker-контейнере.

## 1. Подключение к серверу
```bash
  ssh <user>@<server-ip>
```

## 2. Переход в директорию проекта
```bash
  cd /var/www
```

Эта директория обычно содержит docker-compose.yml и другие файлы запуска сервисов.

## 3. Определение активного контейнера backend

Перед запуском миграции необходимо определить, какой контейнер отвечает за работу backend API.

Выполните:
```bash
  docker ps
```

Найдите контейнер с именем вида:
`backend_8000`
`backend_8001`
`backend_8002`


Название контейнера может отличаться, но оно всегда начинается со слова `backend_` и содержит порт, проброшенный наружу.

Пример строки в выводе:

`3e795ea4eb3c ... "uvicorn ..." ... backend_8002`

## 4. Вход в контейнер backend

Войдите в контейнер с помощью команды:

```bash
  docker exec -it <container_name> bash
```


Пример:
`docker exec -it backend_8002 bash`

После выполнения команды вы окажетесь внутри контейнера backend.

## 5. Применение миграции

Внутри контейнера выполните команду:
```bash
  alembic upgrade head
```


После успешного применения миграций команда завершится без ошибок.

## 6. Проверка текущей версии миграций (необязательно)

Для проверки, что миграция применена, выполните:
```bash
  alembic current
```

В выводе должна отображаться последняя ревизия (head).

## 7. Завершение работы

После выполнения миграций выйдите из контейнера:
```bash
  exit
```

На этом процесс применения миграции завершён.